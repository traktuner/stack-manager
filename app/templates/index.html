{% extends "base.html" %}

{% block content %}
<section id="actions">
    <div class="grid">
        <button class="secondary" hx-post="/api/stacks/upgrade" hx-target="#modal-content" hx-swap="innerHTML">
            Upgrade All
        </button>
        <button class="secondary" hx-post="/api/stacks/pull" hx-target="#modal-content" hx-swap="innerHTML">
            Pull All
        </button>
        <button class="secondary" hx-post="/api/update" hx-target="#modal-content" hx-swap="innerHTML">
            Update
        </button>
        <button class="secondary outline" hx-post="/api/cleanup" hx-target="#modal-content" hx-swap="innerHTML"
                hx-confirm="Run docker system prune? This removes unused images and containers (volumes are preserved).">
            Cleanup
        </button>
    </div>
</section>

<section id="stack-list" hx-get="/api/stacks" hx-trigger="load, every 10s" hx-swap="morph:innerHTML">
    <article aria-busy="true">Loading stacks...</article>
</section>

<dialog id="output-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="closeModal()"></button>
            <span id="modal-title">Command Output</span>
        </header>
        <div id="modal-content">
            <pre class="output-pre">No command running.</pre>
        </div>
    </article>
</dialog>

<dialog id="logs-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="closeLogsModal()"></button>
            <span class="logs-title" id="logs-title">Container Logs</span>
        </header>
        <div class="logs-body">
            <div class="logs-controls">
                <select id="logs-lines" onchange="reloadLogs()">
                    <option value="50">50 lines</option>
                    <option value="100" selected>100 lines</option>
                    <option value="500">500 lines</option>
                    <option value="1000">1000 lines</option>
                </select>
                <button class="outline secondary" onclick="reloadLogs()">Refresh</button>
            </div>
            <pre class="logs-pre" id="logs-pre"><span aria-busy="true">Loading...</span></pre>
        </div>
    </article>
</dialog>
{% endblock %}
