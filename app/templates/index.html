{% extends "base.html" %}

{% block content %}
<section id="actions">
    <div class="grid">
        <button class="secondary" hx-post="/api/stacks/upgrade" hx-target="#modal-content" hx-swap="innerHTML">
            Upgrade All
        </button>
        <button class="secondary" hx-post="/api/stacks/pull" hx-target="#modal-content" hx-swap="innerHTML">
            Pull All
        </button>
        <button class="secondary" hx-post="/api/update" hx-target="#modal-content" hx-swap="innerHTML">
            Update
        </button>
        <button class="secondary outline" hx-post="/api/cleanup" hx-target="#modal-content" hx-swap="innerHTML"
                data-confirm="Run docker system prune? This removes unused images and containers (volumes are preserved).">
            Cleanup
        </button>
    </div>
    <button id="layout-toggle" class="outline secondary" onclick="toggleLayout()" title="Toggle grid/list layout">
        <svg id="layout-icon-grid" viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
            <path d="M1 1h6v6H1V1zm8 0h6v6H9V1zM1 9h6v6H1V9zm8 0h6v6H9V9z"/>
        </svg>
        <svg id="layout-icon-list" viewBox="0 0 16 16" fill="currentColor" width="14" height="14" style="display:none">
            <path d="M1 2h14v2H1V2zm0 5h14v2H1V7zm0 5h14v2H1v-2z"/>
        </svg>
    </button>
</section>

<section id="stack-list" hx-get="/api/stacks" hx-trigger="load, every 10s" hx-swap="morph:innerHTML">
    <div class="loading-splash">
        <svg class="loading-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2L2 7l10 5 10-5-10-5z" fill="rgba(46,204,113,0.15)" stroke="#5fdb8f"/>
            <path d="M2 12l10 5 10-5" stroke="#6db3f2"/>
            <path d="M2 17l10 5 10-5" stroke="#a78bfa"/>
        </svg>
        <span>Loading stacks...</span>
    </div>
</section>

<dialog id="output-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="closeModal()"></button>
            <span id="modal-title">Command Output</span>
        </header>
        <div id="modal-content">
            <pre class="output-pre">No command running.</pre>
        </div>
    </article>
</dialog>

<dialog id="logs-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="closeLogsModal()"></button>
            <span class="logs-title" id="logs-title">Container Logs</span>
        </header>
        <div class="logs-body">
            <div class="logs-controls">
                <select id="logs-lines" onchange="reloadLogs()">
                    <option value="50">50 lines</option>
                    <option value="100" selected>100 lines</option>
                    <option value="500">500 lines</option>
                    <option value="1000">1000 lines</option>
                </select>
                <button class="outline secondary" onclick="reloadLogs()">Refresh</button>
            </div>
            <pre class="logs-pre" id="logs-pre"><span aria-busy="true">Loading...</span></pre>
        </div>
    </article>
</dialog>

<dialog id="confirm-modal">
    <article>
        <header>
            <button aria-label="Close" rel="prev" onclick="dismissConfirm()"></button>
            <span id="confirm-title">Confirm</span>
        </header>
        <div class="confirm-body">
            <p id="confirm-message"></p>
            <input type="text" id="confirm-input" placeholder="" autocomplete="off" style="display:none">
            <div class="confirm-actions">
                <button class="outline secondary" onclick="dismissConfirm()">Cancel</button>
                <button id="confirm-ok-btn" onclick="acceptConfirm()">OK</button>
            </div>
        </div>
    </article>
</dialog>
{% endblock %}
